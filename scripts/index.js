const API_KEY = 'AIzaSyA2yOfGt_ejLBH7z3LbtbhyGy7bwi2pONY';
const MOCK_DATA = {
  kind: 'youtube#searchListResponse',
  etag: '"XI7nbFXulYBIpL0ayR_gDh3eu1k/uR8oM8cIyMf5TSzsM-Tm3jRtAs0"',
  nextPageToken: 'CAUQAA',
  regionCode: 'US',
  pageInfo: {
    totalResults: 1000000,
    resultsPerPage: 5
  },
  items: [
    {
      kind: 'youtube#searchResult',
      etag: '"XI7nbFXulYBIpL0ayR_gDh3eu1k/dkVsFonSTHSsVgcan59qRr-UCko"',
      id: {
        kind: 'youtube#video',
        videoId: 'NwlwJjelgzs'
      },
      snippet: {
        publishedAt: '2018-03-30T11:30:00.000Z',
        channelId: 'UCKy3MG7_If9KlVuvw3rPMfw',
        title: 'Get ready for LAUGHING SUPER HARD - Best FUNNY DOG videos',
        description:
          'Dogs and puppies are super funny and hilarious, they make us laugh all the time! The hardest TRY NOT TO LAUGH challenge in the World! Just look how all ...',
        thumbnails: {
          default: {
            url: 'https://i.ytimg.com/vi/NwlwJjelgzs/default.jpg',
            width: 120,
            height: 90
          },
          medium: {
            url: 'https://i.ytimg.com/vi/NwlwJjelgzs/mqdefault.jpg',
            width: 320,
            height: 180
          },
          high: {
            url: 'https://i.ytimg.com/vi/NwlwJjelgzs/hqdefault.jpg',
            width: 480,
            height: 360
          }
        },
        channelTitle: 'Tiger Productions',
        liveBroadcastContent: 'none'
      }
    },
    {
      kind: 'youtube#searchResult',
      etag: '"XI7nbFXulYBIpL0ayR_gDh3eu1k/-HKwERN1Sudb4KGwpxvK76iZ9GE"',
      id: {
        kind: 'youtube#video',
        videoId: 'aEzZLXBH3rU'
      },
      snippet: {
        publishedAt: '2017-07-08T17:22:26.000Z',
        channelId: 'UCrBYTP-sa4dtOjMWEBfR_Ng',
        title:
          '*Try Not To Laugh Challenge* Funny Dogs Compilation - Funniest Dog Videos 2017',
        description:
          '"IMPOSSIBLE CHALLENGE" Try not to laugh while watching Funny Dog Videos Compilation 2017, The best and funniest dogs videos ever Hope you enjoy ...',
        thumbnails: {
          default: {
            url: 'https://i.ytimg.com/vi/aEzZLXBH3rU/default.jpg',
            width: 120,
            height: 90
          },
          medium: {
            url: 'https://i.ytimg.com/vi/aEzZLXBH3rU/mqdefault.jpg',
            width: 320,
            height: 180
          },
          high: {
            url: 'https://i.ytimg.com/vi/aEzZLXBH3rU/hqdefault.jpg',
            width: 480,
            height: 360
          }
        },
        channelTitle: 'All Of Vines',
        liveBroadcastContent: 'none'
      }
    },
    {
      kind: 'youtube#searchResult',
      etag: '"XI7nbFXulYBIpL0ayR_gDh3eu1k/ZjiyAF244qW6wir9VN1pxVIfLzk"',
      id: {
        kind: 'youtube#channel',
        channelId: 'UCcqLkZqBfBOKmi4vrgkQ6yw'
      },
      snippet: {
        publishedAt: '2013-12-21T03:24:11.000Z',
        channelId: 'UCcqLkZqBfBOKmi4vrgkQ6yw',
        title: 'Dogs - Topic',
        description:
          'The domestic dog is a member of the genus Canis, which forms part of the wolf-like canids, and is the most widely abundant terrestrial carnivore. The dog and ...',
        thumbnails: {
          default: {
            url:
              'https://yt3.ggpht.com/-wegtoaGfVQA/AAAAAAAAAAI/AAAAAAAAAAA/B51JbgmtYcQ/s88-c-k-no-mo-rj-c0xffffff/photo.jpg'
          },
          medium: {
            url:
              'https://yt3.ggpht.com/-wegtoaGfVQA/AAAAAAAAAAI/AAAAAAAAAAA/B51JbgmtYcQ/s240-c-k-no-mo-rj-c0xffffff/photo.jpg'
          },
          high: {
            url:
              'https://yt3.ggpht.com/-wegtoaGfVQA/AAAAAAAAAAI/AAAAAAAAAAA/B51JbgmtYcQ/s800-c-k-no-mo-rj-c0xffffff/photo.jpg'
          }
        },
        channelTitle: 'Dogs - Topic',
        liveBroadcastContent: 'none'
      }
    },
    {
      kind: 'youtube#searchResult',
      etag: '"XI7nbFXulYBIpL0ayR_gDh3eu1k/viybePy1jQvnTdMKEjnZy7y8pAw"',
      id: {
        kind: 'youtube#video',
        videoId: 'rZVpo5HbDf8'
      },
      snippet: {
        publishedAt: '2018-09-20T17:04:55.000Z',
        channelId: 'UCz35G-z-ZB5rTma2yka7G8A',
        title: 'Ep 8: WIENER DOG PRISON BREAK - Funny Dogs Escaping Jail!',
        description:
          'In this video, Crusoe and Oakley the miniature #dachshunds get locked up in jail for a misdewiener crime and then have to find a way to bust themselves out in ...',
        thumbnails: {
          default: {
            url: 'https://i.ytimg.com/vi/rZVpo5HbDf8/default.jpg',
            width: 120,
            height: 90
          },
          medium: {
            url: 'https://i.ytimg.com/vi/rZVpo5HbDf8/mqdefault.jpg',
            width: 320,
            height: 180
          },
          high: {
            url: 'https://i.ytimg.com/vi/rZVpo5HbDf8/hqdefault.jpg',
            width: 480,
            height: 360
          }
        },
        channelTitle: 'Crusoe the Celebrity Dachshund',
        liveBroadcastContent: 'none'
      }
    },
    {
      kind: 'youtube#searchResult',
      etag: '"XI7nbFXulYBIpL0ayR_gDh3eu1k/ewKxgDGd2zeva-5noZeowJrGv80"',
      id: {
        kind: 'youtube#video',
        videoId: '-G16EX6b8Xg'
      },
      snippet: {
        publishedAt: '2018-07-24T17:00:01.000Z',
        channelId: 'UC4rlAVgAK0SGk-yTfe48Qpw',
        title: '12 Harmful Things You Do to Your Dog Without Realizing It',
        description:
          "How to Keep Your Dog Healthy. If you're a dog owner, you surely want your pet to be healthy and to live a long and happy life. But you might sometimes do ...",
        thumbnails: {
          default: {
            url: 'https://i.ytimg.com/vi/-G16EX6b8Xg/default.jpg',
            width: 120,
            height: 90
          },
          medium: {
            url: 'https://i.ytimg.com/vi/-G16EX6b8Xg/mqdefault.jpg',
            width: 320,
            height: 180
          },
          high: {
            url: 'https://i.ytimg.com/vi/-G16EX6b8Xg/hqdefault.jpg',
            width: 480,
            height: 360
          }
        },
        channelTitle: 'BRIGHT SIDE',
        liveBroadcastContent: 'none'
      }
    }
  ]
};

/*
  We want our store to hold an array of "decorated" video objects - i.e. objects that
  have been transformed into ONLY the necessary data we're displaying on our page. 
  (Removes extraneous dataset from Youtube.)
  
  Example decorated video object:
  
  {
    id: '98ds8fbsdy67',
    title: 'Cats dancing the Macarena',
    thumbnail: 'https://img.youtube.com/some/thumbnail.jpg'
  }
*/
const store = {
  videos: []
};

// TASK: Add the Youtube Search API Base URL here:
// Documentation is here: https://developers.google.com/youtube/v3/docs/search/list#usage
const BASE_URL = 'https://www.googleapis.com/youtube/v3/search';

/**
 * @function fetchVideos
 * Async function, responsible for calling the Youtube API with jQuery, constructing
 * the correct query object, and passing along the callback into the AJAX call.
 * @param {string}   searchTerm
 * @param {function} callback
 */
// TASK:
// 1. Use `searchTerm` to construct the right query object based on the Youtube API docs

//    - Refer to curriculum assignment for help with the required parameters
// 2. Make a getJSON call using the query object and sending the provided callback in
//    as the last argument
//
// TEST IT! Execute this function and console log the results inside the callback.
// buildApiRequest('GET',
// '/youtube/v3/search',
// {'maxResults': '25',
//  'part': 'snippet',
//  'q': 'surfing',
//  'type': ''});

function fetchVideos(searchTerm, callback) {
  const settings = {
    url: BASE_URL,
    data: {
      q: `${searchTerm}`,
      key: API_KEY,
      part: 'snippet',
      maxResults: 5,
      type: ''
    },
    dataType: 'json',
    type: 'GET',
    success: callback
  };

  $.getJSON(settings);
}

/**
 * @function decorateResponse
 * Uses Youtube API response to create an array of "decorated" video objects as
 * defined at the top of the file.
 * @param   {object} response - should match Youtube API response shape
 * @returns {array}
 */

function decorateResponse(response) {
    return response.items.map(item => {
      return {
      title: item.snippet.title,
      thumbnail: item.snippet.thumbnails.default.url,
      id: item.snippet.videoId,
      };
    });
}

// TASK:
// 1. Map through the response object's `items` array
// 2. Return an array of objects, where each object contains the keys `id`, `title`,
//    `thumbnail` which each hold the appropriate values from the API item object. You
//    WILL have to dig into several nested properties!
//
// TEST IT! Grab an example API response and send it into the function - make sure
// you get back the object you want.

/**
 * @function generateVideoItemHtml
 * Template function, creates an HTML string from a single decorated video object
 * @param   {object} video - decorated video object
 * @returns {string} HTML
 */
// TASK:
// 1. Using the decorated object, return an HTML string containing all the expected
// TEST IT!
const generateVideoItemHtml = function(video) {
  console.log(video.thumbnail)
  return ` 
    <li data-video-id="${video.id}" >
     <img src="${video.thumbnail}" >
        <h3>${video.title}</h3>
    </li>
  `;
};

// const decoratedObjects = decorateResponse(MOCK_DATA);
// console.log(generateVideoItemHtml(decoratedObjects[0]));

/**
 * @function addVideosToStore
 * Store modification function to set decorated video objects
 * @param {array} videos - decorated video objects
 */
// TASK:
// 1. Set the received array as the value held in store.videos
// TEST IT!
const addVideosToStore = function(videos) {
  store.videos = videos;
};

/**
 * @function render
 * Responsible for scanning store and rendering the video list to DOM
 */
// TASK:
// 1. Map through `store.videos`, sending each `video` through `generateVideoItemHtml`
// 2. Add this array of DOM elements to the appropriate DOM element
// TEST IT!
const render = function() {
    const html = store.videos.map(video => generateVideoItemHtml(video));
    $('.results').html(html);
};

/**
 * @function handleFormSubmit
 * Adds form "submit" event listener that 1) initiates API call, 2) modifies store,
 * and 3) invokes render
 */
// TASK:
// 2. Add an event listener to the form that will:
//   a) Prevent default event
//   b) Retrieve the search input from the DOM
//   c) Clear the search input field
//   d) Invoke the `fetchVideos` function, sending in the search value
//   e) Inside the callback, send the API response through the `decorateResponse` function
//   f) Inside the callback, add the decorated response into your store using the
//      `addVideosToStore` function
//   g) Inside the callback, run the `render` function
// TEST IT!

const handleFormSubmit = function() {
 $('form').on('submit', event => {
   console.log(`this button has been clicked`)
   event.preventDefault();
   const searchTerm = $('#search-term').val(); 
   fetchVideos(searchTerm, function(response) {
     const decorated = decorateResponse(response);
     addVideosToStore(decorated);
     render();
   })
 });

};

// When DOM is ready:
$(function() {
  handleFormSubmit();
});
